---
export interface Props {
  src: string;
  title?: string;
  poster?: string;
}

const { src, title = "Play game", poster = "/assets/jam-transparent.webp" } = Astro.props;
---

<div class="game-embed" data-src={src}>
  <img class="game-embed-bg" src={poster} alt="" />
  <div class="game-embed-controls">
    <button class="play-button" aria-label={title}>â–¶</button>
    <span class="play-text">Click to Play</span>
  </div>
</div>

<style>
.game-embed {
  width: 100%;
  height: 600px;
  background: #000;
  cursor: pointer;
  border-radius: 8px;
  position: relative;
  overflow: hidden;
}
.game-embed-bg {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  height: 75%;
  width: auto;
  max-width: 100%;
  object-fit: contain;
  pointer-events: none;
}
.game-embed-controls {
  position: absolute;
  bottom: 12%;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
}
.play-button {
  font-size: 1.75rem;
  background: color-mix(in srgb, var(--accent) 20%, transparent);
  border: 3px solid color-mix(in srgb, var(--accent) 60%, transparent);
  border-radius: 50%;
  width: 70px;
  height: 70px;
  color: #fff;
  cursor: pointer;
  transition: transform 0.2s, background 0.2s, box-shadow 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 20px color-mix(in srgb, var(--accent) 30%, transparent);
  padding-left: 4px; /* Optical adjustment - play triangles look left-heavy */
}
.game-embed:hover .play-button {
  transform: scale(1.1);
  background: color-mix(in srgb, var(--accent) 35%, transparent);
  box-shadow: 0 0 30px color-mix(in srgb, var(--accent) 50%, transparent);
}
.play-text {
  color: rgba(255,255,255,0.7);
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
}
.game-embed.loaded {
  background: none;
  cursor: default;
}
.game-embed.loaded .game-embed-bg,
.game-embed.loaded .game-embed-controls {
  display: none;
}
.game-embed :global(iframe) {
  width: 100%;
  height: 100%;
  border: none;
}
</style>

<script>
  document.querySelectorAll('.game-embed').forEach(container => {
    container.addEventListener('click', function(this: HTMLElement) {
      if (this.classList.contains('loaded')) return;
      const src = this.dataset.src;
      if (!src) return;
      const iframe = document.createElement('iframe');
      iframe.src = src;
      iframe.setAttribute('allowfullscreen', '');
      this.appendChild(iframe);
      this.classList.add('loaded');
    });
  });
</script>
